blockMapState.forEach(function (block, index) {
      var oldKey = block.getKey();
      var nextKey = block.getNextSiblingKey();
      var prevKey = block.getPrevSiblingKey();
      var childrenKeys = block.getChildKeys();
      var parentKey = block.getParentKey(); // new key that we will use to build linking

      var key = generateRandomKey(); // we will add it here to re-use it later

      newKeysRef[oldKey] = key;

      if (nextKey) {
        var nextBlock = blockMapState.get(nextKey);

        if (nextBlock) {
          blockMapState.setIn([nextKey, 'prevSibling'], key);
        } else {
          // this can happen when generating random keys for fragments
          blockMapState.setIn([oldKey, 'nextSibling'], null);
        }
      }

      if (prevKey) {
        var prevBlock = blockMapState.get(prevKey);

        if (prevBlock) {
          blockMapState.setIn([prevKey, 'nextSibling'], key);
        } else {
          // this can happen when generating random keys for f...
var oldKey = block.getKey()
var nextKey = block.getNextSiblingKey()
var prevKey = block.getPrevSiblingKey()
var childrenKeys = block.getChildKeys()
var parentKey = block.getParentKey()
var key = generateRandomKey()
newKeysRef[oldKey] = key
var nextBlock = blockMapState.get(nextKey)
blockMapState.setIn([nextKey, 'prevSibling'], key)
blockMapState.setIn([oldKey, 'nextSibling'], null)
var prevBlock = blockMapState.get(prevKey)
blockMapState.setIn([prevKey, 'nextSibling'], key)
blockMapState.setIn([oldKey, 'prevSibling'], null)
parentKey && blockMapState.get(parentKey)
