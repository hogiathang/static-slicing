const integrateOpenAPI = (dir, name, url, patch, callback) => {
  function finish(body) {
    if (patch) patch(body);
    for (let path in body.paths) {
      for (let method in body.paths[path]) {
        let op = body.paths[path][method];
        op.operationId = openapiUtil.getOperationId(method, path, op);
      }
    }
    addIntegration(dir, name, 'openapi', body, callback);
  }

  if (fs.existsSync(url)) {
    let content = fs.readFileSync(url);
    if (url.endsWith('.json')) {
      content = JSON.parse(content);
    } else {
      content = YAML.parse(content);
    }
    finish(content);
  } else {
    request.get(url, (err, resp, body) => {
      if (err) return callback(err);
      resp.headers['content-type'] = resp.headers['content-type'] || '';
      if (resp.headers['content-type'].indexOf('yaml') !== -1) {
        body = YAML.parse(body);
      } else {
        body = JSON.parse(body);
      }
      finish(body);
    })
  }
}
function finish = function finish(body) {
    if (patch) patch(body);
    for (let path in body.paths) {
      for (let method in body.paths[path]) {
        let op = body.paths[path][method];
        op.operationId = openapiUtil.getOperationId(method, path, op);
      }
    }
    addIntegration(dir, name, 'openapi', body, callback);
  }
fs.existsSync(url)
request.get(url, (err, resp, body) => {
      if (err) return callback(err);
      resp.headers['content-type'] = resp.headers['content-type'] || '';
      if (resp.headers['content-type'].indexOf('yaml') !== -1) {
        body = YAML.parse(body);
      } else {
        body = JSON.parse(body);
      }
      finish(body);
    })
