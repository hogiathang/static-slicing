const _ = require('lodash')
const commander = require('commander')
_tmp_7 = require('common-tags')
stripIndent = _tmp_7.stripIndent
require('common-tags')
const logSymbols = require('log-symbols')
const debug = require('debug')('cypress:cli:cli')
const util = require('./util')
const logger = require('./logger')
const errors = require('./errors')
const cache = require('./tasks/cache')
function unknownOption = function unknownOption(flag, type = 'option') {
  if (this._allowUnknownOption) return;
  logger.error();
  logger.error(`  error: unknown ${type}:`, flag);
  logger.error();
  this.outputHelp();
  util.exit(1);
}
commander.Command.prototype.unknownOption = unknownOption
const coerceFalse = arg => {
  return arg !== 'false';
}
const coerceAnyStringToInt = arg => {
  return typeof arg === 'string' ? parseInt(arg) : arg;
}
const spaceDelimitedArgsMsg = (flag, args) => {
  let msg = `
    ${logSymbols.warning} Warning: It looks like you're passing --${flag} a space-separated list of arguments:

    "${args.join(' ')}"

    This will work, but it's not recommended.

    If you are trying to pass multiple arguments, separate them with commas instead:
      cypress run --${flag} arg1,arg2,arg3
  `;
  if (flag === 'spec') {
    msg += `
    The most common cause of this warning is using an unescaped glob pattern. If you are
    trying to pass a glob pattern, escape it using quotes:
      cypress run --spec "**/*.spec.js"
    `;
  }
  logger.log();
  logger.warn(stripIndent(msg));
  logger.log();
}
const parseVariableOpts = (fnArgs, args) => {
  const [opts, unknownArgs] = fnArgs;
  if (unknownArgs && unknownArgs.length && (opts.spec || opts.tag)) {
    // this will capture space-delimited args after
    // flags that could have possible multiple args
    // but before the next option
    // --spec spec1 spec2 or --tag foo bar

    const multiArgFlags = _.compact([opts.spec ? 'spec' : opts.spec, opts.tag ? 'tag' : opts.tag]);
    _.forEach(multiArgFlags, flag => {
      const argIndex = _.indexOf(args, `--${flag}`) + 2;
      const nextOptOffset = _.findIndex(_.slice(args, argIndex), arg => {
        return _.startsWith(arg, '--');
      });
      const endIndex = nextOptOffset !== -1 ? argIndex + nextOptOffset : args.length;
      const maybeArgs = _.slice(args, argIndex, endIndex);
      const extraArgs = _.intersection(maybeArgs, unknownArgs);
      if (extraArgs.length) {
        opts[flag] = [opts[flag]].concat(extraArgs);
        spaceDelimitedArgsMsg(flag, opts[flag]);
      ...
const descriptions = {
  autoCancelAfterFailures: 'overrides the project-level Cloud configuration to set the failed test threshold for auto cancellation or to disable auto cancellation when recording to the Cloud',
  browser: 'runs Cypress in the browser with the given name. if a filesystem path is supplied, Cypress will attempt to use the browser at that path.',
  cacheClear: 'delete all cached binaries',
  cachePrune: 'deletes all cached binaries except for the version currently in use',
  cacheList: 'list cached binary versions',
  cachePath: 'print the path to the binary cache',
  cacheSize: 'Used with the list command to show the sizes of the cached folders',
  ciBuildId: 'the unique identifier for a run on your CI provider. typically a "BUILD_ID" env var. this value is automatically detected for most CI providers',
  component: 'runs component tests',
  config: 'sets configuration values. separate multiple values with a comma. overrides any value in cypress.config.{js,ts,mjs,cjs}.'...
_tmp_14.autoCancelAfterFailures = "overrides the project-level Cloud configuration to set the failed test threshold for auto cancellation or to disable auto cancellation when recording to the Cloud"
_tmp_14.browser = "runs Cypress in the browser with the given name. if a filesystem path is supplied, Cypress will attempt to use the browser at that path."
_tmp_14.cacheClear = "delete all cached binaries"
_tmp_14.cachePrune = "deletes all cached binaries except for the version currently in use"
_tmp_14.cacheList = "list cached binary versions"
_tmp_14.cachePath = "print the path to the binary cache"
_tmp_14.cacheSize = "Used with the list command to show the sizes of the cached folders"
_tmp_14.ciBuildId = "the unique identifier for a run on your CI provider. typically a "BUILD_ID" env var. this value is automatically detected for most CI providers"
_tmp_14.component = "runs component tests"
_tmp_14.config = "sets configuration values. separate multiple values with a comma. overrides any value in cypress.config.{js,ts,mjs,cjs}."
_tmp_14.configFile = "path to script file where configuration values are set. defaults to "cypress.config.{js,ts,mjs,cjs}"."
_tmp_14.detached = "runs Cypress application in detached mode"
_tmp_14.dev = "runs cypress in development and bypasses binary check"
_tmp_14.e2e = "runs end to end tests"
_tmp_14.env = "sets environment variables. separate multiple values with a comma. overrides any value in cypress.config.{js,ts,mjs,cjs} or cypress.env.json"
_tmp_14.exit = "keep the browser open after tests finish"
_tmp_14.forceInstall = "force install the Cypress binary"
_tmp_14.global = "force Cypress into global mode as if its globally installed"
_tmp_14.group = "a named group for recorded runs in Cypress Cloud"
_tmp_14.headed = "displays the browser instead of running headlessly"
_tmp_14.headless = "hide the browser instead of running headed (default for cypress run)"
_tmp_14.key = "your secret Record Key. you can omit this if you set a CYPRESS_RECORD_KEY environment variable."
_tmp_14.parallel = "enables concurrent runs and automatic load balancing of specs across multiple machines or processes"
_tmp_14.port = "runs Cypress on a specific port. overrides any value in cypress.config.{js,ts,mjs,cjs}."
_tmp_14.project = "path to the project"
_tmp_14.quiet = "run quietly, using only the configured reporter"
_tmp_14.record = "records the run. sends test results, screenshots and videos to Cypress Cloud."
_tmp_14.reporter = "runs a specific mocha reporter. pass a path to use a custom reporter. defaults to "spec""
_tmp_14.reporterOptions = "options for the mocha reporter. defaults to "null""
_tmp_14.runnerUi = "displays the Cypress Runner UI"
_tmp_14.noRunnerUi = "hides the Cypress Runner UI"
_tmp_14.spec = "runs specific spec file(s). defaults to "all""
_tmp_14.tag = "named tag(s) for recorded runs in Cypress Cloud"
_tmp_14.version = "prints Cypress version"
const knownCommands = ['cache', 'help', '-h', '--help', 'install', 'open', 'run', 'open-ct', 'run-ct', 'verify', '-v', '--version', 'version', 'info']
const text = description => {
  if (!descriptions[description]) {
    throw new Error(`Could not find description for: ${description}`);
  }
  return descriptions[description];
}
function includesVersion = function includesVersion(args) {
  return _.includes(args, '--version') || _.includes(args, '-v');
}
function showVersions = function showVersions(opts) {
  debug('printing Cypress version');
  debug('additional arguments %o', opts);
  debug('parsed version arguments %o', opts);
  const reportAllVersions = versions => {
    logger.always('Cypress package version:', versions.package);
    logger.always('Cypress binary version:', versions.binary);
    logger.always('Electron version:', versions.electronVersion);
    logger.always('Bundled Node version:', versions.electronNodeVersion);
  };
  const reportComponentVersion = (componentName, versions) => {
    const names = {
      package: 'package',
      binary: 'binary',
      electron: 'electronVersion',
      node: 'electronNodeVersion'
    };
    if (!names[componentName]) {
      throw new Error(`Unknown component name "${componentName}"`);
    }
    const name = names[componentName];
    if (!versions[name]) {
      throw new Error(`Cannot find version for component "${componentName}" under property "${name}"`);
    }
    const version = versions[name]...
const createProgram = () => {
  const program = new commander.Command();

  // bug in commander not printing name
  // in usage help docs
  program._name = 'cypress';
  program.usage('<command> [options]');
  return program;
}
const addCypressRunCommand = program => {
  return program.command('run').usage('[options]').description('Runs Cypress tests from the CLI without the GUI').option('--auto-cancel-after-failures <test-failure-count || false>', text('autoCancelAfterFailures')).option('-b, --browser <browser-name-or-path>', text('browser')).option('--ci-build-id <id>', text('ciBuildId')).option('--component', text('component')).option('-c, --config <config>', text('config')).option('-C, --config-file <config-file>', text('configFile')).option('--e2e', text('e2e')).option('-e, --env <env>', text('env')).option('--group <name>', text('group')).option('-k, --key <record-key>', text('key')).option('--headed', text('headed')).option('--headless', text('headless')).option('--no-exit', text('exit')).option('--parallel', text('parallel')).option('-p, --port <port>', text('port')).option('-P, --project <project-path>', text('project')).option('-q, --quiet', text('quiet')).option('--record [bool]', text('record'), coer...
const addCypressOpenCommand = program => {
  return program.command('open').usage('[options]').description('Opens Cypress in the interactive GUI.').option('-b, --browser <browser-path>', text('browser')).option('--component', text('component')).option('-c, --config <config>', text('config')).option('-C, --config-file <config-file>', text('configFile')).option('-d, --detached [bool]', text('detached'), coerceFalse).option('--e2e', text('e2e')).option('-e, --env <env>', text('env')).option('--global', text('global')).option('-p, --port <port>', text('port')).option('-P, --project <project-path>', text('project')).option('--dev', text('dev'), coerceFalse);
}
const maybeAddInspectFlags = program => {
  if (process.argv.includes('--dev')) {
    return program.option('--inspect', 'Node option').option('--inspect-brk', 'Node option');
  }
  return program;
}
const castCypressOptions = opts => {
  // only properties that have type "string | false" in our TS definition
  // require special handling, because CLI parsing takes care of purely
  // boolean arguments
  const castOpts = {
    ...opts
  };
  if (_.has(opts, 'port')) {
    castOpts.port = coerceAnyStringToInt(opts.port);
  }
  return castOpts;
}
module.exports = {
  /**
   * Parses `cypress run` command line option array into an object
   * with options that you can feed into a `cypress.run()` module API call.
   * @example
   *  const options = parseRunCommand(['cypress', 'run', '--browser', 'chrome'])
   *  // options is {browser: 'chrome'}
   */
  parseRunCommand(args) {
    return new Promise((resolve, reject) => {
      if (!Array.isArray(args)) {
        return reject(new Error('Expected array of arguments'));
      }

      // make a copy of the input arguments array
      // and add placeholders where "node ..." would usually be
      // also remove "cypress" keyword at the start if present
      const cliArgs = args[0] === 'cypress' ? [...args.slice(1)] : [...args];
      cliArgs.unshift(null, null);
      debug('creating program parser');
      const program = createProgram();
      maybeAddInspectFlags(addCypressRunCommand(program)).action((...fnArgs) => {
        debug('parsed Cypress run %o', fnArgs);
        c...
_tmp_61.parseRunCommand = parseRunCommand
_tmp_61.parseOpenCommand = parseOpenCommand
_tmp_61.init = init
!module.parent
logger.error('This CLI module should be required from another Node module')
logger.error('and not executed directly')
process.exit(-1)
