metrics.send_request = function(options, callback) {
        callback = callback || function() {};

        let content = Buffer.from(JSON.stringify(options.data)).toString('base64');
        const endpoint = options.endpoint;
        const method = (options.method || 'GET').toUpperCase();
        let query_params = {
            'ip': metrics.config.geolocate ? 1 : 0,
            'verbose': metrics.config.verbose ? 1 : 0
        };
        const key = metrics.config.key;
        const secret = metrics.config.secret;
        const request_lib = REQUEST_LIBS[metrics.config.protocol];
        let request_options = {
            host: metrics.config.host,
            port: metrics.config.port,
            headers: {},
            method: method
        };
        let request;

        if (!request_lib) {
            throw new Error(
                "Mixpanel Initialization Error: Unsupported protocol " + metrics.config.protocol + ". " +
                "Supported protocols are: " + Obj...
callback = callback || function() {}
let content = Buffer.from(JSON.stringify(options.data)).toString('base64')
const endpoint = options.endpoint
const method = (options.method || 'GET').toUpperCase()
let query_params = {
            'ip': metrics.config.geolocate ? 1 : 0,
            'verbose': metrics.config.verbose ? 1 : 0
        }
_tmp_18.ip = metrics.config.geolocate ? 1 : 0
_tmp_18.verbose = metrics.config.verbose ? 1 : 0
const key = metrics.config.key
const secret = metrics.config.secret
const request_lib = REQUEST_LIBS[metrics.config.protocol]
let request_options = {
            host: metrics.config.host,
            port: metrics.config.port,
            headers: {},
            method: method
        }
_tmp_19.host = metrics.config.host
_tmp_19.port = metrics.config.port
_tmp_19.headers = {}
_tmp_19.method = method
!request_lib
throw new Error(
                "Mixpanel Initialization Error: Unsupported protocol " + metrics.config.protocol + ". " +
                "Supported protocols are: " + Object.keys(REQUEST_LIBS)
            );
"Mixpanel Initialization Error: Unsupported protocol " + metrics.config.protocol + ". " +
                "Supported protocols are: " + Object.keys(REQUEST_LIBS)
Object.keys(REQUEST_LIBS)
method === 'POST'
content = 'data=' + content
request_options.headers['Content-Type'] = 'application/x-www-form-urlencoded'
request_options.headers['Content-Length'] = Buffer.byteLength(content)
method === 'GET'
query_params.data = content
request_lib !== https
throw new Error("Must use HTTPS if authenticating with API Secret");
const encoded = Buffer.from(secret + ':').toString('base64')
request_options.headers['Authorization'] = 'Basic ' + encoded
query_params.api_key = key
endpoint === '/import'
throw new Error("The Mixpanel Client needs a Mixpanel API Secret when importing old events: `init(token, { secret: ... })`");
request_options.agent = proxyAgent || REQUEST_AGENTS[metrics.config.protocol]
metrics.config.test
query_params.test = 1
request_options.path = metrics.config.path + endpoint + "?" + querystring.stringify(query_params)
request = request_lib.request(request_options, function(res) {
            var data = "";
            res.on('data', function(chunk) {
                data += chunk;
            });

            res.on('end', function() {
                var e;
                if (metrics.config.verbose) {
                    try {
                        var result = JSON.parse(data);
                        if(result.status != 1) {
                            e = new Error("Mixpanel Server Error: " + result.error);
                        }
                    }
                    catch(ex) {
                        e = new Error("Could not parse response from Mixpanel");
                    }
                }
                else {
                    e = (data !== '1') ? new Error("Mixpanel Server Error: " + data) : undefined;
                }

                callback(e);
            });
        })
