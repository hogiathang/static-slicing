var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}))
<lambda>2
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
})
<lambda>4
var __importStar = (this && this.__importStar) || function (mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (k !== "default" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);
    __setModuleDefault(result, mod);
    return result;
}
var __importDefault = (this && this.__importDefault) || function (mod) {
    return (mod && mod.__esModule) ? mod : { "default": mod };
}
Object.defineProperty(exports, "__esModule", { value: true })
const NodeJsCompatibility_1 = require("@microsoft/rush-lib/lib/logic/NodeJsCompatibility")
(_tmp_6 = NodeJsCompatibility_1.NodeJsCompatibility).reportAncientIncompatibleVersion
process.exit(1)
const alreadyReportedNodeTooNewError = NodeJsCompatibility_1.NodeJsCompatibility.warnAboutVersionTooNew({
    isRushLib: false,
    alreadyReportedNodeTooNewError: false
})
_tmp_8.isRushLib = false
_tmp_8.alreadyReportedNodeTooNewError = false
const safe_1 = __importDefault(require("colors/safe"))
const os = __importStar(require("os"))
const semver = __importStar(require("semver"))
const node_core_library_1 = require("@rushstack/node-core-library")
const rush_lib_1 = require("@microsoft/rush-lib")
const rushLib = __importStar(require("@microsoft/rush-lib"))
const RushCommandSelector_1 = require("./RushCommandSelector")
const RushVersionSelector_1 = require("./RushVersionSelector")
const MinimalRushConfiguration_1 = require("./MinimalRushConfiguration")
const configuration = MinimalRushConfiguration_1.MinimalRushConfiguration.loadFromDefaultLocation()
const currentPackageVersion = node_core_library_1.PackageJsonLookup.loadOwnPackageJson(__dirname).version
let rushVersionToLoad = undefined
const previewVersion = process.env[rush_lib_1.EnvironmentVariableNames.RUSH_PREVIEW_VERSION]
!semver.valid(previewVersion, false)
console.error(safe_1.default.red(`Invalid value for RUSH_PREVIEW_VERSION environment variable: "${previewVersion}"`))
process.exit(1)
rushVersionToLoad = previewVersion
__ecma.Array.factory()
lines.push(`*********************************************************************`, `* WARNING! THE "RUSH_PREVIEW_VERSION" ENVIRONMENT VARIABLE IS SET.  *`, `*                                                                   *`, `* You are previewing Rush version:        ${node_core_library_1.Text.padEnd(previewVersion, 25)} *`)
<operator>.formatString("* The rush.json configuration asks for:   ", node_core_library_1.Text.padEnd(configuration.rushVersion, 25), " *")
lines.push(`*                                                                   *`, `* To restore the normal behavior, unset the RUSH_PREVIEW_VERSION    *`, `* environment variable.                                             *`, `*********************************************************************`)
console.error(lines.map((line) => safe_1.default.black(safe_1.default.bgYellow(line))).join(os.EOL))
rushVersionToLoad = configuration.rushVersion
rushVersionToLoad && semver.lt(rushVersionToLoad, '5.0.0-dev.18')
delete process.env[rush_lib_1.EnvironmentVariableNames.RUSH_PREVIEW_VERSION]
const isManaged = !!configuration
const terminalProvider = new node_core_library_1.ConsoleTerminalProvider()
const launchOptions = { isManaged, alreadyReportedNodeTooNewError, terminalProvider }
rushVersionToLoad && rushVersionToLoad !== currentPackageVersion
RushCommandSelector_1.RushCommandSelector.execute(currentPackageVersion, rushLib, launchOptions)
