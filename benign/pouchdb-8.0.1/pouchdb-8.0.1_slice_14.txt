function processKeyValueDocs = function processKeyValueDocs(metaDoc, kvDocsRes) {
      const kvDocs = [];
      const oldKeys = new ExportedSet();

      for (let i = 0, len = kvDocsRes.rows.length; i < len; i++) {
        const row = kvDocsRes.rows[i];
        const doc = row.doc;
        if (!doc) { // deleted
          continue;
        }
        kvDocs.push(doc);
        oldKeys.add(doc._id);
        doc._deleted = !indexableKeysToKeyValues.has(doc._id);
        if (!doc._deleted) {
          const keyValue = indexableKeysToKeyValues.get(doc._id);
          if ('value' in keyValue) {
            doc.value = keyValue.value;
          }
        }
      }
      const newKeys = mapToKeysArray(indexableKeysToKeyValues);
      newKeys.forEach(function (key) {
        if (!oldKeys.has(key)) {
          // new doc
          const kvDoc = {
            _id: key
          };
          const keyValue = indexableKeysToKeyValues.get(key);
          if ('value' in keyValue) {
            kvDoc.value = keyValue.value;
    ...
__ecma.Array.factory()
const oldKeys = new ExportedSet()
let len = kvDocsRes.rows.length
const row = kvDocsRes.rows[i]
const doc = row.doc
!doc
continue;
kvDocs.push(doc)
oldKeys.add(doc._id)
doc._deleted = !indexableKeysToKeyValues.has(doc._id)
!doc._deleted
const keyValue = indexableKeysToKeyValues.get(doc._id)
'value' in keyValue
doc.value = keyValue.value
