var fs = require("node:fs/promises")
var supportsColor = require("chalk").supportsColor
var program = require("commander").program
var debug = require("debug")
var lintStaged = require("../lib/index.js")
var CONFIG_STDIN_ERROR = require("../lib/messages.js").CONFIG_STDIN_ERROR
var readStdin = require("../lib/readStdin.js").readStdin
process.env.FORCE_COLOR = supportsColor.level.toString()
process.on('SIGINT', () => {})
const packageJson = JSON.parse(await fs.readFile(new URL('../package.json', import.meta.url)))
const version = packageJson.version
const debugLog = debug('lint-staged:bin')
debugLog('Running `lint-staged@%s`', version)
const cli = program.version(version)
cli.option('--allow-empty', 'allow empty commits when tasks revert all staged changes', false)
cli.option(
  '-p, --concurrent <number|boolean>',
  'the number of tasks to run concurrently, or false for serial',
  true
)
"-p, --concurrent <number|boolean>"
"the number of tasks to run concurrently, or false for serial"
cli.option('-c, --config [path]', 'path to configuration file, or - to read from stdin')
cli.option('--cwd [path]', 'run all tasks in specific directory, instead of the current')
cli.option('-d, --debug', 'print additional debug information', false)
cli.addOption(
  new Option(
    '--diff [string]',
    'override the default "--staged" flag of "git diff" to get list of files. Implies "--no-stash".'
  ).implies({ stash: false })
)
new Option(
    '--diff [string]',
    'override the default "--staged" flag of "git diff" to get list of files. Implies "--no-stash".'
  ).implies({ stash: false })
"--diff [string]"
"override the default "--staged" flag of "git diff" to get list of files. Implies "--no-stash"."
_tmp_4.stash = false
cli.option(
  '--diff-filter [string]',
  'override the default "--diff-filter=ACMR" flag of "git diff" to get list of files'
)
"--diff-filter [string]"
"override the default "--diff-filter=ACMR" flag of "git diff" to get list of files"
cli.option('--max-arg-length [number]', 'maximum length of the command-line argument string', 0)
cli
  .addOption(
    new Option('--stash', 'enable the backup stash, and revert in case of errors')
      .default(true)
      .hideHelp()
  )
  .addOption(
    new Option(
      '--no-stash',
      'disable the backup stash, and do not revert in case of errors'
    ).default(false)
  )
addOption
(_tmp_6 = new Option('--stash', 'enable the backup stash, and revert in case of errors')
      .default(true)).hideHelp
default
hideHelp
addOption
(_tmp_9 = new Option(
      '--no-stash',
      'disable the backup stash, and do not revert in case of errors'
    )).default
"--no-stash"
"disable the backup stash, and do not revert in case of errors"
default
cli.option('-q, --quiet', 'disable lint-stagedâ€™s own console output', false)
cli.option('-r, --relative', 'pass relative filepaths to tasks', false)
cli.option('-x, --shell [path]', 'skip parsing of tasks for better shell support', false)
cli.option(
  '-v, --verbose',
  'show task output even when tasks succeed; by default only failed output is shown',
  false
)
"-v, --verbose"
"show task output even when tasks succeed; by default only failed output is shown"
const cliOptions = cli.parse(process.argv).opts()
cliOptions.debug
debug.enable('lint-staged*')
const options = {
  allowEmpty: !!cliOptions.allowEmpty,
  concurrent: JSON.parse(cliOptions.concurrent),
  configPath: cliOptions.config,
  cwd: cliOptions.cwd,
  debug: !!cliOptions.debug,
  diff: cliOptions.diff,
  diffFilter: cliOptions.diffFilter,
  maxArgLength: cliOptions.maxArgLength || undefined,
  quiet: !!cliOptions.quiet,
  relative: !!cliOptions.relative,
  shell: cliOptions.shell /* Either a boolean or a string pointing to the shell */,
  stash: !!cliOptions.stash, // commander inverts `no-<x>` flags to `!x`
  verbose: !!cliOptions.verbose,
}
_tmp_12.allowEmpty = !!cliOptions.allowEmpty
_tmp_12.concurrent = JSON.parse(cliOptions.concurrent)
_tmp_12.configPath = cliOptions.config
_tmp_12.cwd = cliOptions.cwd
_tmp_12.debug = !!cliOptions.debug
_tmp_12.diff = cliOptions.diff
_tmp_12.diffFilter = cliOptions.diffFilter
_tmp_12.maxArgLength = cliOptions.maxArgLength || undefined
_tmp_12.quiet = !!cliOptions.quiet
_tmp_12.relative = !!cliOptions.relative
_tmp_12.shell = cliOptions.shell
_tmp_12.stash = !!cliOptions.stash
_tmp_12.verbose = !!cliOptions.verbose
debugLog('Options parsed from command-line:', options)
options.configPath === '-'
delete options.configPath
debugLog('Reading config from stdin')
options.config = JSON.parse(await readStdin())
debugLog(CONFIG_STDIN_ERROR, error)
console.error(CONFIG_STDIN_ERROR)
process.exit(1)
