function (req, resp, next) {
    var url = req.url;
    // You can pass the route within the options, as well
    if (typeof options.route === 'string') {
      if (url === options.route) {
        url = '';
      } else if (url.slice(0, options.route.length) === options.route) {
        url = url.slice(options.route.length);
      } else {
        return next();
      }
    }

    //options for this request
    var opts = extend({}, options);
    if (url && url.charAt(0) === '?') { // prevent /api/resource/?offset=0
      if (options.pathname.length > 1 && options.pathname.charAt(options.pathname.length - 1) === '/') {
        opts.path = options.pathname.substring(0, options.pathname.length - 1) + url;
      } else {
        opts.path = options.pathname + url;
      }
    } else if (url) {
      opts.path = slashJoin(options.pathname, url);
    } else {
      opts.path = options.pathname;
    }
    opts.method = req.method;
    opts.headers = options.headers ? merge(req.headers, o...
var url = req.url
typeof options.route === 'string'
url === options.route
url = ''
url.slice(0, options.route.length) === options.route
url = url.slice(options.route.length)
var opts = extend({}, options)
url && url.charAt(0) === '?'
options.pathname.length > 1 && options.pathname.charAt(options.pathname.length - 1) === '/'
opts.path = options.pathname.substring(0, options.pathname.length - 1) + url
opts.path = options.pathname + url
opts.path = slashJoin(options.pathname, url)
opts.path = options.pathname
opts.method = req.method
opts.headers = options.headers ? merge(req.headers, options.headers) : req.headers
applyViaHeader(req.headers, opts, opts.headers)
!options.preserveHost
delete opts.headers.host
