function WM = function WM({body:e,client:A,request:t,socket:r,contentLength:n,header:i,expectsPayload:s}){D(n!==0||A[Fe]===0,"stream body cannot be pipelined");let o=!1,a=new qa({socket:r,request:t,contentLength:n,client:A,expectsPayload:s,header:i}),c=function(E){if(!o)try{!a.write(E)&&this.pause&&this.pause()}catch(h){v.destroy(this,h)}},g=function(){o||e.resume&&e.resume()},l=function(){u(new tp)},u=function(E){if(!o){if(o=!0,D(r.destroyed||r[Lt]&&A[Fe]<=1),r.off("drain",g).off("error",u),e.removeListener("data",c).removeListener("end",u).removeListener("error",u).removeListener("close",l),!E)try{a.end()}catch(h){E=h}a.destroy(E),E&&(E.code!=="UND_ERR_INFO"||E.message!=="reset")?v.destroy(e,E):v.destroy(e)}};e.on("data",c).on("end",u).on("error",u).on("close",l),e.resume&&e.resume(),r.on("drain",g).on("error",u)}
var qa=class{constructor({socket:A,request:t,contentLength:r,client:n,expectsPayload:i,header:s}){this.socket=A,this.request=t,this.contentLength=r,this.client=n,this.bytesWritten=0,this.expectsPayload=i,this.header=s,A[Lt]=!0}write(A){let{socket:t,request:r,contentLength:n,client:i,bytesWritten:s,expectsPayload:o,header:a}=this;if(t[bA])throw t[bA];if(t.destroyed)return!1;let c=Buffer.byteLength(A);if(!c)return!0;if(n!==null&&s+c>n){if(i[Va])throw new Fr;process.emitWarning(new Fr)}t.cork(),s===0&&(o||(t[iA]=!0),n===null?t.write(`${a}transfer-encoding: chunked\r
`,"latin1"):t.write(`${a}content-length: ${n}\r
\r
`,"latin1")),n===null&&t.write(`\r
${c.toString(16)}\r
`,"latin1"),this.bytesWritten+=c;let g=t.write(A);return t.uncork(),r.onBodySent(A),g||t[Be].timeout&&t[Be].timeoutType===Wn&&t[Be].timeout.refresh&&t[Be].timeout.refresh(),g}end(){let{socket:A,contentLength:t,client:r,bytesWritten:n,expectsPayload:i,header:s,request:o}=this;if(o.onRequestSent(),A[Lt]=!1,A[bA])throw A[bA];i...
