var fs = require('fs')
var path = require('path')
var os = require('os')
var hook = path.join(__dirname, 'hook')
var root = path.resolve(__dirname, '..', '..')
var exists = fs.existsSync || path.existsSync
var git = path.resolve(root, '.git')
var hooks = path.resolve(git, 'hooks')
var precommit = path.resolve(hooks, 'pre-commit')
!exists(git) || !fs.lstatSync(git).isDirectory()
fs.mkdirSync(hooks)
exists(precommit) && !fs.lstatSync(precommit).isSymbolicLink()
console.log('pre-commit:')
console.log('pre-commit: Detected an existing git pre-commit hook')
fs.writeFileSync(precommit +'.old', fs.readFileSync(precommit))
console.log('pre-commit: Old pre-commit hook backuped to pre-commit.old')
console.log('pre-commit:')
fs.unlinkSync(precommit)
var hookRelativeUnixPath = hook.replace(root, '.')
os.platform() === 'win32'
hookRelativeUnixPath = hookRelativeUnixPath.replace(/[\\\/]+/g, '/')
var precommitContent = '#!/bin/bash' + os.EOL
  +  hookRelativeUnixPath + os.EOL
  + 'RESULT=$?' + os.EOL
  + '[ $RESULT -ne 0 ] && exit 1' + os.EOL
  + 'exit 0' + os.EOL
os.EOL
os.EOL
os.EOL
os.EOL
fs.writeFileSync(precommit, precommitContent)
console.error('pre-commit:')
console.error('pre-commit: Failed to create the hook file in your .git/hooks folder because:')
console.error('pre-commit: '+ e.message)
console.error('pre-commit: The hook was not installed.')
console.error('pre-commit:')
fs.chmodSync(precommit, '777')
