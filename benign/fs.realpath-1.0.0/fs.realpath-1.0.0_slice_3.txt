exports.realpathSync = function realpathSync(p, cache) {
  // make p is absolute
  p = pathModule.resolve(p);

  if (cache && Object.prototype.hasOwnProperty.call(cache, p)) {
    return cache[p];
  }

  var original = p,
      seenLinks = {},
      knownHard = {};

  // current character position in p
  var pos;
  // the partial path so far, including a trailing slash if any
  var current;
  // the partial path without a trailing slash (except when pointing at a root)
  var base;
  // the partial path scanned in the previous round, with slash
  var previous;

  start();

  function start() {
    // Skip over roots
    var m = splitRootRe.exec(p);
    pos = m[0].length;
    current = m[0];
    base = m[0];
    previous = '';

    // On windows, check that the root exists. On unix there is no need.
    if (isWindows && !knownHard[base]) {
      fs.lstatSync(base);
      knownHard[base] = true;
    }
  }

  // walk down the path, swapping out linked pathparts for their real
  // value...
p = pathModule.resolve(p)
cache && Object.prototype.hasOwnProperty.call(cache, p)
var original = p
var seenLinks = {}
var knownHard = {}
start()
function start = function start() {
    // Skip over roots
    var m = splitRootRe.exec(p);
    pos = m[0].length;
    current = m[0];
    base = m[0];
    previous = '';

    // On windows, check that the root exists. On unix there is no need.
    if (isWindows && !knownHard[base]) {
      fs.lstatSync(base);
      knownHard[base] = true;
    }
  }
pos < p.length
nextPartRe.lastIndex = pos
var result = nextPartRe.exec(p)
previous = current
current += result[0]
base = previous + result[1]
pos = nextPartRe.lastIndex
knownHard[base] || (cache && cache[base] === base)
continue;
cache && Object.prototype.hasOwnProperty.call(cache, base)
resolvedLink = cache[base]
var stat = fs.lstatSync(base)
!stat.isSymbolicLink()
knownHard[base] = true
cache[base] = base
continue;
var linkTarget = null
!isWindows
var id = stat.dev.toString(32) + ':' + stat.ino.toString(32)
seenLinks.hasOwnProperty(id)
linkTarget = seenLinks[id]
linkTarget === null
fs.statSync(base)
linkTarget = fs.readlinkSync(base)
resolvedLink = pathModule.resolve(previous, linkTarget)
cache[base] = resolvedLink
seenLinks[id] = linkTarget
p = pathModule.resolve(resolvedLink, p.slice(pos))
start()
