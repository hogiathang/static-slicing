const fs = require('fs')
const path = require('path')
const args = process.argv.slice(2)
const dir = args[0]
!dir
console.log('Usage: node ' + path.basename(__filename) + ' <target-dir>')
process.exit(1)
function listFiles = function listFiles (dir, filelist) {
  const files = fs.readdirSync(dir);
  filelist = filelist || [];
  files.forEach(function (file) {
    if (file === 'node_modules') {
      return;
    }

    if (fs.statSync(path.join(dir, file)).isDirectory()) {
      filelist = listFiles(path.join(dir, file), filelist);
    } else {
      filelist.push(path.join(dir, file));
    }
  });
  return filelist;
}
function convert = function convert (content, operations) {
  for (let i = 0; i < operations.length; i++) {
    const operation = operations[i];
    content = content.replace(operation[0], operation[1]);
  }
  return content;
}
function convertFile = function convertFile (fileName, operations) {
  fs.readFile(fileName, 'utf-8', function (err, file) {
    if (err) throw err;

    file = convert(file, operations);

    fs.writeFile(fileName, file, function (err) {
      if (err) throw err;
    });
  });
}
