Promise.resolve().then(() => {
    const type = req.headers['content-type'] || 'text/plain';
    const length = req.headers['content-length'];

    const body = rawBodyMap.get(req);

    if (body) {
      return body;
    }

    return getRawBody(req, {
      limit,
      length,
      encoding: encoding ?? contentType.parse(type).parameters.charset,
    })
      .then((buf) => {
        rawBodyMap.set(req, buf);
        return buf;
      })
      .catch((err) => {
        if (isRawBodyError(err) && err.type === 'entity.too.large') {
          throw createError(413, `Body exceeded ${limit} limit`, err);
        } else {
          throw createError(400, 'Invalid body', err as Error);
        }
      });
  })
const type = req.headers['content-type'] || 'text/plain'
const length = req.headers['content-length']
const body = rawBodyMap.get(req)
