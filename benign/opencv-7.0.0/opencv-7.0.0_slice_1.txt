Matrix.fromArray = function(arr, type){
  var n_bytes;

  var bytesAndChannels = getNumberOfBytesAndChannelsPerType(type);
  var bytes = bytesAndChannels.bytes;
  var channels = bytesAndChannels.channels;
  var dataType = bytesAndChannels.dataType;
  var label = bytesAndChannels.label;

  if(!Array.isArray(arr) ||!Array.isArray(arr[0]) || !Array.isArray(arr[0][0]) || (channels && arr[0][0].length !== channels)) {
    throw(new Error("Input array must be a 3-level array/matrix with size rows x cols x channels corresponding to dataType ("+label+")"));
  }

  if(!channels){
    channels = 1;
  }

  var rows = arr.length;
  var cols = arr[0].length;

  var mat = new cv.Matrix(rows, cols, type);

  var n_bytes = bytes/8;
  var buf = new Buffer(rows * cols * channels * n_bytes);

  buf.fill(0);

  var fnName = getBufferMethodName(bytes, dataType, os.endianness(), false)

  for(var i=0;i<rows * cols * channels;i++){
    var c = i%channels;
    var r = Math.floor(i/channels);
    var y = r%...
var bytesAndChannels = getNumberOfBytesAndChannelsPerType(type)
var bytes = bytesAndChannels.bytes
var channels = bytesAndChannels.channels
var dataType = bytesAndChannels.dataType
var label = bytesAndChannels.label
!Array.isArray(arr) ||!Array.isArray(arr[0]) || !Array.isArray(arr[0][0]) || (channels && arr[0][0].length !== channels)
throw(new Error("Input array must be a 3-level array/matrix with size rows x cols x channels corresponding to dataType ("+label+")"));
!channels
channels = 1
var rows = arr.length
var cols = arr[0].length
var mat = new cv.Matrix(rows, cols, type)
var n_bytes = bytes/8
var buf = new Buffer(rows * cols * channels * n_bytes)
buf.fill(0)
var fnName = getBufferMethodName(bytes, dataType, os.endianness(), false)
i<rows * cols * channels
var c = i%channels
var r = Math.floor(i/channels)
var y = r%cols
var x = Math.floor(r/cols)
buf[fnName](arr[x][y][c], i*n_bytes)
mat.put(buf)
