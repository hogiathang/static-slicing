function upload = function upload(option) {
    var xhr = new XMLHttpRequest();

    if (option.onProgress && xhr.upload) {
        xhr.upload.onprogress = function progress(e) {
            if (e.total > 0) {
                e.percent = e.loaded / e.total * 100;
            }
            option.onProgress(e);
        };
    }

    var formData = new FormData();

    if (option.data) {
        Object.keys(option.data).forEach(function (key) {
            formData.append(key, option.data[key]);
        });
    }
    if (option.file instanceof Blob) {
        formData.append(option.filename, option.file, option.file.name);
    } else {
        formData.append(option.filename, option.file);
    }

    xhr.onerror = function error(e) {
        option.onError(e);
    };

    xhr.onload = function onload() {
        // allow success when 2xx status
        // see https://github.com/react-component/upload/issues/34
        if (xhr.status < 200 || xhr.status >= 300) {
            return option.onError(getErr...
var xhr = new XMLHttpRequest()
option.onProgress && xhr.upload
xhr.upload.onprogress = function progress(e) {
            if (e.total > 0) {
                e.percent = e.loaded / e.total * 100;
            }
            option.onProgress(e);
        }
var formData = new FormData()
option.data
Object.keys(option.data).forEach(function (key) {
            formData.append(key, option.data[key]);
        })
option.file instanceof Blob
formData.append(option.filename, option.file, option.file.name)
formData.append(option.filename, option.file)
xhr.onerror = function error(e) {
        option.onError(e);
    }
xhr.onload = function onload() {
        // allow success when 2xx status
        // see https://github.com/react-component/upload/issues/34
        if (xhr.status < 200 || xhr.status >= 300) {
            return option.onError(getError(option, xhr), getBody(xhr));
        }

        option.onSuccess(getBody(xhr), xhr);
    }
option.method = option.method || 'POST'
xhr.open(option.method, option.action, true)
var timeout = option.timeout
typeof timeout === 'number' && timeout > 0
xhr.timeout = timeout
xhr.ontimeout = function () {
            var msg = 'Upload abort for exceeding time (timeout: ' + timeout + 'ms)';
            option.onError(getError(option, xhr, msg), getBody(xhr));
        }
option.withCredentials && 'withCredentials' in xhr
xhr.withCredentials = true
var headers = option.headers || {}
headers['X-Requested-With'] !== null
xhr.setRequestHeader('X-Requested-With', 'XMLHttpRequest')
_iterator_0 = <operator>.iterator(headers)
headers.hasOwnProperty(h) && headers[h] !== null
xhr.setRequestHeader(h, headers[h])
xhr.send(formData)
