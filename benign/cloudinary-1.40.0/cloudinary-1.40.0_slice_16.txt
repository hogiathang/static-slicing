function execute_request = function execute_request(method, params, auth, api_url, callback, options = {}) {
  method = method.toUpperCase();
  const deferred = Q.defer();

  let query_params, handle_response; // declare to user later
  let key = auth.key;
  let secret = auth.secret;
  let oauth_token = auth.oauth_token;
  let content_type = 'application/x-www-form-urlencoded';

  if (options.content_type === 'json') {
    query_params = JSON.stringify(params);
    content_type = 'application/json';
  } else {
    query_params = querystring.stringify(params);
  }

  if (method === "GET") {
    api_url += "?" + query_params;
  }

  let request_options = url.parse(api_url);

  request_options = extend(request_options, {
    method: method,
    headers: {
      'Content-Type': content_type,
      'User-Agent': utils.getUserAgent()
    }
  });

  if (oauth_token) {
    request_options.headers.Authorization = `Bearer ${oauth_token}`;
  } else {
    request_options.auth = key + ":" + secret
  }

  if (options.agent...
method = method.toUpperCase()
const deferred = Q.defer()
let key = auth.key
let secret = auth.secret
let oauth_token = auth.oauth_token
let content_type = 'application/x-www-form-urlencoded'
options.content_type === 'json'
query_params = JSON.stringify(params)
content_type = 'application/json'
query_params = querystring.stringify(params)
method === "GET"
api_url += "?" + query_params
let request_options = url.parse(api_url)
request_options = extend(request_options, {
    method: method,
    headers: {
      'Content-Type': content_type,
      'User-Agent': utils.getUserAgent()
    }
  })
_tmp_1.method = method
_tmp_1.headers = {
      'Content-Type': content_type,
      'User-Agent': utils.getUserAgent()
    }
_tmp_2.Content-Type = content_type
_tmp_2.User-Agent = utils.getUserAgent()
request_options.headers.Authorization = `Bearer ${oauth_token}`
request_options.auth = key + ":" + secret
options.agent != null
request_options.agent = options.agent
let proxy = options.api_proxy || config().api_proxy
!isEmpty(proxy)
!request_options.agent && agent
request_options.agent = agent
!request_options.agent
request_options.agent = new https.Agent(proxy)
console.warn("Proxy is set, but request uses a custom agent, proxy is ignored.")
method !== "GET"
request_options.headers['Content-Length'] = Buffer.byteLength(query_params)
handle_response = function (res) {
    const {hide_sensitive = false} = config();
    const sanitizedOptions = {...request_options};

    if (hide_sensitive === true){
      if ("auth" in sanitizedOptions) { delete sanitizedOptions.auth; }
      if ("Authorization" in sanitizedOptions.headers) { delete sanitizedOptions.headers.Authorization; }
    }

    if (includes([200, 400, 401, 403, 404, 409, 420, 500], res.statusCode)) {
      let buffer = "";
      let error = false;
      res.on("data", function (d) {
        buffer += d;
        return buffer;
      });
      res.on("end", function () {
        let result;
        if (error) {
          return;
        }
        try {
          result = JSON.parse(buffer);
        } catch (e) {
          result = {
            error: {
              message: "Server return invalid JSON response. Status Code " + res.statusCode
            }
          };
        }

        if (result.error) {
          result.error.http_code = res.statusCode;...
const request = https.request(request_options, handle_response)
