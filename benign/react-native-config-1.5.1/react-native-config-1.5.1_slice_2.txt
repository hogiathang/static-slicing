const fs = require('fs')
const path = require('path')
const readline = require('readline')
const envFile = path.join(process.argv[2], '..', process.env['ENVFILE'] || '.env')
const outDir = path.join(process.argv[3], 'Generated Files')
<operator>.formatString("Generating files in ", outDir, " from ", envFile, " env file")
!fs.existsSync(outDir)
fs.mkdirSync(outDir)
function generateFiles = function generateFiles(vars) {
  // Native code
  let nativeCode = '';
  // React Native Module code
  let rnCode = '';
  nativeCode += '#include<string>\n'
  nativeCode += 'namespace ReactNativeConfig {\n'
  for (let {key, value} of vars) {
    const escaped = escapeString(value)
    nativeCode += `  inline static std::string ${key} = ${escaped};\n`
    rnCode += `REACT_CONSTANT(${key});\n`
    rnCode += `static inline const std::string ${key} = ${escaped};\n`;
  }
  nativeCode +='}\n'
  updateFile(nativeCode, path.join(outDir, 'RNCConfigValues.h'))
  updateFile(rnCode, path.join(outDir, 'RNCConfigValuesModule.inc.g.h'))
}
function escapeString = function escapeString(string) {
  let escaped = '"';
  for (let i = 0;  i < string.length; ++i) {
    if (!string.substr(i,1).match(escapeRegex))
      escaped += `\\u${string.charCodeAt(i).toString(16)}`
    else
      escaped += string[i]
  }
  escaped += '"';
  return escaped;
}
function updateFile = function updateFile(content, filename) {
  if (!fs.existsSync(filename) || fs.readFileSync(filename) != content) {
    fs.writeFileSync(filename, content)
    console.log(`Written ${filename}`)
  } else {
    console.log(`Skipped ${filename} since content was not changed`)
  }
}
