var reloadCSS = require('reload-css')
var errorPopup = require('./error-popup')
module.exports = connect()
function connect = function connect () {
  var reconnectPoll = 1000
  var maxRetries = 50
  var retries = 0
  var reconnectInterval
  var isReconnecting = false
  var protocol = document.location.protocol
  var hostname = document.location.hostname
  var port = document.location.port
  var host = hostname + ':' + port

  var isIOS = /(iOS|iPhone|iPad|iPod)/i.test(navigator.userAgent)
  var isSSL = /^https:/i.test(protocol)
  var queued = []
  var socket = createWebSocket()
  var listeners = []

  var api = {
    send: function (message) {
      message = JSON.stringify(message)
      if (socket && socket.readyState === 1) {
        socket.send(message)
      } else {
        queued.push(message)
      }
    },
    listen: function (cb) {
      if (typeof cb !== 'function') {
        throw new TypeError('cb must be a function!')
      }
      listeners.push(cb)
    },
    removeListener: function (cb) {
      var idx = listeners.indexOf(cb)
      if (idx !== -1) {
        listeners.splice(idx, 1)
     ...
function reloadPage = function reloadPage () {
  window.location.reload(true)
}
