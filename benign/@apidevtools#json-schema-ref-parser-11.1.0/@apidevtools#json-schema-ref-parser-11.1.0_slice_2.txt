function download = async function download(u: URL | string, httpOptions: HTTPResolverOptions, _redirects?: string[]): Promise<Buffer> {
  u = url.parse(u);
  const redirects = _redirects || [];
  redirects.push(u.href);

  try {
    const res = await get(u, httpOptions);
    if (res.status >= 400) {
      throw ono({ status: res.status }, `HTTP ERROR ${res.status}`);
    } else if (res.status >= 300) {
      if (!Number.isNaN(httpOptions.redirects) && redirects.length > httpOptions.redirects!) {
        throw new ResolverError(
          ono(
            { status: res.status },
            `Error downloading ${redirects[0]}. \nToo many redirects: \n  ${redirects.join(" \n  ")}`,
          ),
        );
      } else if (!("location" in res.headers) || !res.headers.location) {
        throw ono({ status: res.status }, `HTTP ${res.status} redirect with no location header`);
      } else {
        const redirectTo = url.resolve(u.href, res.headers.location as string);
        return download(redirectTo, h...
u = url.parse(u)
const redirects = _redirects || []
redirects.push(u.href)
