var WebSocket = function(request, socket, body, protocols, options) {
  options = options || {};

  this._stream = socket;
  this._driver = driver.http(request, { maxLength: options.maxLength, protocols: protocols });

  var self = this;
  if (!this._stream || !this._stream.writable) return;
  if (!this._stream.readable) return this._stream.end();

  var catchup = function() { self._stream.removeListener('data', catchup) };
  this._stream.on('data', catchup);

  API.call(this, options);

  process.nextTick(function() {
    self._driver.start();
    self._driver.io.write(body);
  });
}
options = options || {}
this._stream = socket
this._driver = driver.http(request, { maxLength: options.maxLength, protocols: protocols })
var self = this
!this._stream || !this._stream.writable
(_tmp_2 = this._stream).end
var catchup = function() { self._stream.removeListener('data', catchup) }
this._stream.on('data', catchup)
API.call(this, options)
process.nextTick(function() {
    self._driver.start();
    self._driver.io.write(body);
  })
