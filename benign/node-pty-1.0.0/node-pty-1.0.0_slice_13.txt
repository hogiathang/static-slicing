var parentPort = require("worker_threads").parentPort
var createServer = require("net").createServer
var ConoutWorkerMessage = require("../shared/conout").ConoutWorkerMessage
const conoutPipeName = (workerData as IWorkerData).conoutPipeName
const conoutSocket = new Socket()
conoutSocket.setEncoding('utf8')
conoutSocket.connect(conoutPipeName, () => {
  const server = createServer(workerSocket => {
    conoutSocket.pipe(workerSocket);
  });
  server.listen(getWorkerPipeName(conoutPipeName));

  if (!parentPort) {
    throw new Error('worker_threads parentPort is null');
  }
  parentPort.postMessage(ConoutWorkerMessage.READY);
})
