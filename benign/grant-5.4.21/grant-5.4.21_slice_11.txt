module.exports = ({request:client}) => async ({provider, input, output}) => {
  if (!provider.response || !provider.response.includes('profile')) {
    return {provider, input, output}
  }

  if (provider.apple && !provider.profile_url && input.body.user) {
    output.profile = input.body.user
    return {provider, input, output}
  }

  if (!provider.profile_url) {
    output.profile = {error: 'Grant: No profile URL found!'}
    return {provider, input, output}
  }

  var options = {
    method: 'GET',
    url: provider.profile_url,
    headers: {},
  }

  if (provider.oauth === 2) {
    options.headers.authorization = `Bearer ${output.access_token}`
  }
  else if (provider.oauth === 1) {
    options.oauth = {
      consumer_key: provider.key,
      consumer_secret: provider.secret,
      token: output.access_token,
      token_secret: output.access_secret,
    }
  }

  if (custom[provider.name]) {
    Object.assign(options, custom[provider.name]({provider, output}))
  }

  if (prov...
!provider.response || !provider.response.includes('profile')
provider.apple && !provider.profile_url && input.body.user
!provider.profile_url
var options = {
    method: 'GET',
    url: provider.profile_url,
    headers: {},
  }
_tmp_5.method = "GET"
_tmp_5.url = provider.profile_url
_tmp_5.headers = {}
provider.oauth === 2
options.headers.authorization = `Bearer ${output.access_token}`
provider.oauth === 1
options.oauth = {
      consumer_key: provider.key,
      consumer_secret: provider.secret,
      token: output.access_token,
      token_secret: output.access_secret,
    }
_tmp_7.consumer_key = provider.key
_tmp_7.consumer_secret = provider.secret
_tmp_7.token = output.access_token
_tmp_7.token_secret = output.access_secret
custom[provider.name]
Object.assign(options, custom[provider.name]({provider, output}))
provider.subdomain
options.url = options.url.replace('[subdomain]', provider.subdomain)
_tmp_11 = await request({...client, ...options})
provider.flickr
body = JSON.parse(/^.*\((.*)\)/.exec(body)[1])
provider.qq
body = JSON.parse(/^.*\((.*)\)/.exec(Object.keys(body)[0])[1])
body = {...body, ...(await request({...client, ...options,
        url: 'https://graph.qq.com/user/get_user_info',
        qs: {
          access_token: output.access_token,
          oauth_consumer_key: provider.key,
          openid: body.openid
        }
      })).body}
