module.exports = function getEmbeddedDiscriminatorPath(doc, path, options) {
  options = options || {};
  const typeOnly = options.typeOnly;
  const parts = Array.isArray(path) ?
    path :
    (path.indexOf('.') === -1 ? [path] : path.split('.'));
  let schemaType = null;
  let type = 'adhocOrUndefined';

  const schema = getSchemaDiscriminatorByValue(doc.schema, doc.get(doc.schema.options.discriminatorKey)) || doc.schema;

  for (let i = 0; i < parts.length; ++i) {
    const subpath = parts.slice(0, i + 1).join('.');
    schemaType = schema.path(subpath);
    if (schemaType == null) {
      type = 'adhocOrUndefined';
      continue;
    }
    if (schemaType.instance === 'Mixed') {
      return typeOnly ? 'real' : schemaType;
    }
    type = schema.pathType(subpath);
    if ((schemaType.$isSingleNested || schemaType.$isMongooseDocumentArrayElement) &&
    schemaType.schema.discriminators != null) {
      const discriminators = schemaType.schema.discriminators;
      const discrimi...
options = options || {}
const typeOnly = options.typeOnly
const parts = Array.isArray(path) ?
    path :
    (path.indexOf('.') === -1 ? [path] : path.split('.'))
path.indexOf('.') === -1 ? [path] : path.split('.')
let schemaType = null
let type = 'adhocOrUndefined'
const schema = getSchemaDiscriminatorByValue(doc.schema, doc.get(doc.schema.options.discriminatorKey)) || doc.schema
i < parts.length
const subpath = parts.slice(0, i + 1).join('.')
schemaType = schema.path(subpath)
schemaType == null
type = 'adhocOrUndefined'
continue;
schemaType.instance === 'Mixed'
type = schema.pathType(subpath)
(schemaType.$isSingleNested || schemaType.$isMongooseDocumentArrayElement) &&
    schemaType.schema.discriminators != null
schemaType.schema.discriminators != null
const discriminators = schemaType.schema.discriminators
const discriminatorKey = doc.get(subpath + '.' +
        get(schemaType, 'schema.options.discriminatorKey'))
get(schemaType, 'schema.options.discriminatorKey')
discriminatorKey == null || discriminators[discriminatorKey] == null
continue;
const rest = parts.slice(i + 1).join('.')
getEmbeddedDiscriminatorPath(doc.get(subpath), rest, options)
