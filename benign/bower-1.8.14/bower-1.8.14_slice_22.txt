function fetch = function fetch(url, file, options) {
    var deferred = Q.defer();

    var contentLength;
    var bytesDownloaded = 0;

    var reject = function(error) {
        deferred.reject(error);
    };

    var req = progress(request(url, options), {
        delay: options.progressDelay
    })
        .on('response', function(response) {
            contentLength = Number(response.headers['content-length']);

            var status = response.statusCode;

            if (status < 200 || status >= 300) {
                return deferred.reject(
                    createError('Status code of ' + status, 'EHTTP')
                );
            }

            var writeStream = createWriteStream(file);
            var errored = false;

            // Change error listener so it cleans up writeStream before exiting
            req.removeListener('error', reject);
            req.on('error', function(error) {
                errored = true;
                destroy(req);
                destroy(wr...
var deferred = Q.defer()
var bytesDownloaded = 0
var reject = function(error) {
        deferred.reject(error);
    }
