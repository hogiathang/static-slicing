var tmp = require('tmp')
var fs = require('fs')
var path = require('path')
var glob = require('glob')
var childProcess = require('child_process')
var arraydiff = require('arr-diff')
var wrench = require('wrench')
var jsonPackage = require('./package')
childProcess
        .execSync('git rev-parse --abbrev-ref HEAD')
        .toString()
        .trim() !== 'master'
"git rev-parse --abbrev-ref HEAD"
toString
"master"
console.log('You need to release bower from the "master" branch')
process.exit(1)
var dir = path.join(tmp.dirSync().name, 'package')
console.log('\nInstalling production bundle in:')
console.log(dir + '\n')
wrench.copyDirSyncRecursive(__dirname, dir, {
    forceDelete: true,
    include: function(path) {
        return !path.match(/node_modules|\.git|test/);
    }
})
_tmp_2.forceDelete = true
_tmp_2.include = <lambda>0
delete jsonPackage.scripts
delete jsonPackage.private
jsonPackage.workspaces.forEach(function(name) {
    jsonPackage.dependencies[name.split('/').reverse()[0]] = 'file:./' + name;
})
delete jsonPackage.workspaces
fs.writeFileSync(
    path.resolve(dir, 'package.json'),
    JSON.stringify(jsonPackage, null, '  ') + '\n'
)
path.resolve(dir, 'package.json')
JSON.stringify(jsonPackage, null, '  ') + '\n'
