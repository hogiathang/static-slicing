function doRequest = function doRequest(index, callback) {
    var req;
    var msg;
    var requestUrl = this._config.registry.search[index] + '/packages';
    var remote = url.parse(requestUrl);
    var headers = {};
    var that = this;

    if (this._config.userAgent) {
        headers['User-Agent'] = this._config.userAgent;
    }

    req = replay(
        request.get(
            requestUrl,
            {
                ca: this._config.ca.search[index],
                headers: headers,
                strictSSL: this._config.strictSsl,
                timeout: this._config.timeout,
                json: true
            },
            function(err, response, body) {
                // If there was an internal error (e.g. timeout)
                if (err) {
                    return callback(
                        createError(
                            'Request to ' +
                                requestUrl +
                                ' failed: ' +
                                e...
var requestUrl = this._config.registry.search[index] + '/packages'
var remote = url.parse(requestUrl)
var headers = {}
var that = this
this._config.userAgent
headers['User-Agent'] = this._config.userAgent
request.get(
            requestUrl,
            {
                ca: this._config.ca.search[index],
                headers: headers,
                strictSSL: this._config.strictSsl,
                timeout: this._config.timeout,
                json: true
            },
            function(err, response, body) {
                // If there was an internal error (e.g. timeout)
                if (err) {
                    return callback(
                        createError(
                            'Request to ' +
                                requestUrl +
                                ' failed: ' +
                                err.message,
                            err.code
                        )
                    );
                }

                // Abort if there was an error (range different than 2xx)
                if (response.statusCode < 200 || response.statusCode > 299) {
                    return callback(
                        createError(
...
