fs.readdirSync(path).forEach(function (filename) {
    var joined = join(path, filename),
      files,
      key,
      obj;

    if (fs.statSync(joined).isDirectory() && options.recurse) {
      // this node is a directory; recurse
      files = requireDirectory(m, joined, options);
      // exclude empty directories
      if (Object.keys(files).length) {
        retval[options.rename(filename, joined, filename)] = files;
      }
    } else {
      if (joined !== m.filename && checkFileInclusion(joined, filename, options)) {
        // hash node key shouldn't include file extension
        key = filename.substring(0, filename.lastIndexOf('.'));
        obj = m.require(joined);
        retval[options.rename(key, joined, filename)] = options.visit(obj, joined, filename) || obj;
      }
    }
  })
var joined = join(path, filename)
fs.statSync(joined).isDirectory() && options.recurse
joined !== m.filename && checkFileInclusion(joined, filename, options)
key = filename.substring(0, filename.lastIndexOf('.'))
obj = m.require(joined)
retval[options.rename(key, joined, filename)] = options.visit(obj, joined, filename) || obj
