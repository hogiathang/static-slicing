function generateHelpers = async function generateHelpers() {
  let output = `/*
 * This file is auto-generated! Do not modify it directly.
 * To re-generate run 'yarn gulp generate-runtime-helpers'
 */

import template from "@babel/template";

function helper(minVersion: string, source: string) {
  return Object.freeze({
    minVersion,
    ast: () => template.program.ast(source, { preserveComments: true }),
  })
}

export default Object.freeze({
`;

  for (const file of (await fs.promises.readdir(HELPERS_FOLDER)).sort()) {
    if (IGNORED_FILES.has(file)) continue;
    if (file.startsWith(".")) continue; // ignore e.g. vim swap files

    const [helperName] = file.split(".");

    const filePath = join(fileURLToPath(HELPERS_FOLDER), file);
    if (!file.endsWith(".js")) {
      console.error("ignoring", filePath);
      continue;
    }

    const fileContents = await fs.promises.readFile(filePath, "utf8");
    const minVersionMatch = fileContents.match(
      /^\s*\/\*\s*@minVersion\s+(?<minVersion>\S+)\s*\...
let output = `/*
 * This file is auto-generated! Do not modify it directly.
 * To re-generate run 'yarn gulp generate-runtime-helpers'
 */

import template from "@babel/template";

function helper(minVersion: string, source: string) {
  return Object.freeze({
    minVersion,
    ast: () => template.program.ast(source, { preserveComments: true }),
  })
}

export default Object.freeze({
`
_iterator_0 = <operator>.iterator((await fs.promises.readdir(HELPERS_FOLDER)).sort())
IGNORED_FILES.has(file)
file.startsWith(".")
_tmp_5 = file.split(".")
const filePath = join(fileURLToPath(HELPERS_FOLDER), file)
!file.endsWith(".js")
console.error("ignoring", filePath)
continue;
const fileContents = await fs.promises.readFile(filePath, "utf8")
const minVersionMatch = fileContents.match(
      /^\s*\/\*\s*@minVersion\s+(?<minVersion>\S+)\s*\*\/\s*$/m
    )
/^\s*\/\*\s*@minVersion\s+(?<minVersion>\S+)\s*\*\/\s*$/m
!minVersionMatch
<operator>.formatString("@minVersion number missing in ", filePath, "")
_tmp_8 = minVersionMatch.groups
const source = await minify(fileContents, {
      mangle: { keep_fnames: true },
      // The _typeof helper has a custom directive that we must keep
      compress: { directives: false },
    })
_tmp_9.mangle = { keep_fnames: true }
_tmp_9.compress = { directives: false }
<operator>.formatString("\
  ", JSON.stringify(helperName), ": helper(
    ", JSON.stringify(minVersion), ",
    ", JSON.stringify(source.code), ",
  ),
")
JSON.stringify(helperName)
JSON.stringify(minVersion)
JSON.stringify(source.code)
