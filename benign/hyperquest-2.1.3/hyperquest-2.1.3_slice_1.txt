server.listen(5000, function () {
    var pending = 20;
    for (var i = 0; i < 20; i++) {
        var r = request('http://localhost:5000/' + i);
        r.pipe(process.stdout, { end: false });
        r.on('end', function () {
            if (--pending === 0) server.close();
        });
    }
})
var pending = 20
var i = 0
var r = request('http://localhost:5000/' + i)
r.pipe(process.stdout, { end: false })
r.on('end', function () {
            if (--pending === 0) server.close();
        })
