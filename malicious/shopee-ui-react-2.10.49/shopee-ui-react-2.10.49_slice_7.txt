function upload = function upload(option) {
  var xhr = new XMLHttpRequest();

  if (option.onProgress && xhr.upload) {
    xhr.upload.onprogress = function progress(e) {
      var percent = 0;

      if (e.total > 0) {
        percent = e.loaded / e.total * 100;
      }

      option.onProgress(Object.assign(Object.assign({}, e), {
        percent: percent
      }));
    };
  }

  var formData = new FormData();

  if (option.data) {
    Object.keys(option.data).forEach(function (key) {
      var value = option.data[key]; // support key-value array data

      if (Array.isArray(value)) {
        value.forEach(function (item) {
          // { list: [ 11, 22 ] }
          // formData.append('list[]', 11);
          formData.append("".concat(key, "[]"), item);
        });
        return;
      }

      formData.append(key, option.data[key]);
    });
  }

  formData.append(option.filename, option.file);

  xhr.onerror = function error() {
    option.onError(getError(option, xhr));
  };

  xhr.onload = fu...
var xhr = new XMLHttpRequest()
option.onProgress && xhr.upload
xhr.upload.onprogress = function progress(e) {
      var percent = 0;

      if (e.total > 0) {
        percent = e.loaded / e.total * 100;
      }

      option.onProgress(Object.assign(Object.assign({}, e), {
        percent: percent
      }));
    }
var formData = new FormData()
option.data
Object.keys(option.data).forEach(function (key) {
      var value = option.data[key]; // support key-value array data

      if (Array.isArray(value)) {
        value.forEach(function (item) {
          // { list: [ 11, 22 ] }
          // formData.append('list[]', 11);
          formData.append("".concat(key, "[]"), item);
        });
        return;
      }

      formData.append(key, option.data[key]);
    })
formData.append(option.filename, option.file)
xhr.onerror = function error() {
    option.onError(getError(option, xhr));
  }
xhr.onload = function onload() {
    // allow success when 2xx status
    // see https://github.com/react-component/upload/issues/34
    if (xhr.status < 200 || xhr.status >= 300) {
      option.onError(getError(option, xhr), getBody(xhr));
      return;
    }

    option.onSuccess(getBody(xhr), xhr);
  }
xhr.open(option.method, option.action, true)
option.withCredentials && 'withCredentials' in xhr
xhr.withCredentials = true
var headers = option.headers || {}
_iterator_0 = <operator>.iterator(headers)
Object.prototype.hasOwnProperty.call(headers, h) && headers[h] !== null
xhr.setRequestHeader(h, headers[h])
xhr.send(formData)
