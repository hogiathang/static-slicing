function upload = function upload(option: Options): XMLHttpRequest {
  if (typeof XMLHttpRequest === 'undefined') {
    return;
  }

  const xhr = new XMLHttpRequest();
  const { action } = option;

  if (xhr.upload) {
    xhr.upload.onprogress = function progress(e: ProgressEventType) {
      if (e.total > 0) {
        e.percent = (e.loaded / e.total) * 100;
      }
      option.onProgress(e);
    };
  }

  const formData = new FormData();

  if (option.data) {
    const extraData = typeof option.data === 'function' ? option.data(option.file) : option.data;
    Object.keys(extraData).forEach((key) => {
      formData.append(key, option.data[key]);
    });
  }

  formData.append(option.name, option.file, option.file.name);

  xhr.onerror = function error(e) {
    option.onError(e, xhr);
  };

  xhr.onload = function onload() {
    if (xhr.status < 200 || xhr.status >= 300) {
      return option.onError(getError(action, option, xhr), xhr);
    }

    option.onSuccess(getBody(xhr));
  };

  xhr.onabort...
typeof XMLHttpRequest === 'undefined'
const xhr = new XMLHttpRequest()
action = _tmp_2.action
xhr.upload
xhr.upload.onprogress = function progress(e: ProgressEventType) {
      if (e.total > 0) {
        e.percent = (e.loaded / e.total) * 100;
      }
      option.onProgress(e);
    }
const formData = new FormData()
option.data
const extraData = typeof option.data === 'function' ? option.data(option.file) : option.data
Object.keys(extraData).forEach((key) => {
      formData.append(key, option.data[key]);
    })
formData.append(option.name, option.file, option.file.name)
xhr.onerror = function error(e) {
    option.onError(e, xhr);
  }
xhr.onload = function onload() {
    if (xhr.status < 200 || xhr.status >= 300) {
      return option.onError(getError(action, option, xhr), xhr);
    }

    option.onSuccess(getBody(xhr));
  }
xhr.onabort = function onabort() {
  }
xhr.open('post', action, true)
option.withCredentials && 'withCredentials' in xhr
xhr.withCredentials = true
const headers = option.headers || {}
Object.keys(headers).forEach((key) => {
    const item = headers[key];
    if (item !== null) {
      xhr.setRequestHeader(key, item);
    }
  })
xhr.send(formData)
