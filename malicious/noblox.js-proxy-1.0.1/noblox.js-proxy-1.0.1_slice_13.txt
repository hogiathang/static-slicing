module.exports = function (type, index, func, handler) {
  const group = options.queue[type]
  if (!group[index]) {
    group[index] = {
      jobs: []
    }
  }
  const home = group[index]
  function run (time) {
    return function (resolve, reject) {
      setTimeout(function () {
        func().then(resolve).catch(reject)
      }, time)
    }
  }
  const jobs = home.jobs
  function deactivate (err) {
    jobs.shift()
    if (!handler(err)) {
      home.last = Date.now()
    }
  }
  function next () {
    jobs.shift()
    home.last = Date.now()
  }
  if (group.delay > 0) {
    const delay = group.delay
    const last = home.last
    if (jobs.length === 0) {
      let item
      const diff = Date.now() - last
      if (!last || diff > delay) {
        item = func()
      } else {
        item = promise(run(delay - diff))
      }
      jobs.push(item)
      item.then(next).catch(deactivate)
      return item
    } else {
      const job = jobs[jobs.length - 1].then(function () {
  ...
const group = options.queue[type]
!group[index]
group[index] = {
      jobs: []
    }
_tmp_2.jobs = __ecma.Array.factory()
const home = group[index]
function run = function run (time) {
    return function (resolve, reject) {
      setTimeout(function () {
        func().then(resolve).catch(reject)
      }, time)
    }
  }
const jobs = home.jobs
function deactivate = function deactivate (err) {
    jobs.shift()
    if (!handler(err)) {
      home.last = Date.now()
    }
  }
function next = function next () {
    jobs.shift()
    home.last = Date.now()
  }
group.delay > 0
const delay = group.delay
const last = home.last
jobs.length === 0
const diff = Date.now() - last
!last || diff > delay
item = promise(run(delay - diff))
