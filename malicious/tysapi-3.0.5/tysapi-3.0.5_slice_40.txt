module.exports.app = async function() {
  // Retrieve Tysapi version.
  this.config.uuid = get(this.config.info, 'tysapi.uuid', '');
  this.config.info.customs = get(this.config.info, 'tysapi', {});
  this.config.info.tysapi = (get(this.config, 'info.dependencies.tysapi') || '').replace(/(\^|~)/g, ''),
  this.config.info.node = process.versions.node;

  // Set connections.
  this.connections = {};

  // Set current environment config.
  this.config.currentEnvironment = this.config.environments[this.config.environment] || {};

  // Set current connections.
  this.config.connections = get(this.config.currentEnvironment, 'database.connections', {});

  if (get(this.config, 'language.enabled')) {
    this.config.language.locales = Object.keys(get(tysapi.config, 'locales', {}));
  }

  // Template literal string.
  this.config = templateConfiguration(this.config);

  // Initialize main router to use it in middlewares.
  this.router = this.koaMiddlewares.routerJoi();

  // Set controllers...
this.config.uuid = get(this.config.info, 'tysapi.uuid', '')
this.config.info.customs = get(this.config.info, 'tysapi', {})
this.config.info.tysapi = (get(this.config, 'info.dependencies.tysapi') || '').replace(/(\^|~)/g, '')
this.config.info.node = process.versions.node
this.connections = {}
this.config.currentEnvironment = this.config.environments[this.config.environment] || {}
this.config.connections = get(this.config.currentEnvironment, 'database.connections', {})
get(this.config, 'language.enabled')
this.config.language.locales = Object.keys(get(tysapi.config, 'locales', {}))
this.config = templateConfiguration(this.config)
this.router = this.koaMiddlewares.routerJoi()
this.controllers = Object.keys(this.api || []).reduce((acc, key) => {
    for (let index in this.api[key].controllers) {
      if (!this.api[key].controllers[index].identity) {
        this.api[key].controllers[index].identity = upperFirst(index);
      }

      acc[index] = this.api[key].controllers[index];
    }

    return acc;
  }, {})
this.models = Object.keys(this.api || []).reduce((acc, key) => {
    for (let index in this.api[key].models) {
      if (!this.api[key].models[index].globalId) {
        this.api[key].models[index].globalId = upperFirst(camelCase(index));
      }

      if (!this.api[key].models[index].connection) {
        this.api[key].models[index].connection = this.config.currentEnvironment.database.defaultConnection;
      }

      if (!this.api[key].models[index].collectionName) {
        this.api[key].models[index].collectionName = (`${index}`).toLowerCase();
      }

      acc[index] = this.api[key].models[index];
    }
    return acc;
  }, {})
this.services = Object.keys(this.api || []).reduce((acc, key) => {
    for (let index in this.api[key].services) {
      acc[index] = this.api[key].services[index];
    }

    return acc;
  }, {})
this.config.routes = Object.keys(this.api || []).reduce((acc, key) => {
    return acc.concat(get(this.api[key], 'config.routes') || {});
  }, [])
__ecma.Array.factory()
this.admin.controllers = Object.keys(this.admin.controllers || []).reduce((acc, key) => {
    if (!this.admin.controllers[key].identity) {
      this.admin.controllers[key].identity = key;
    }

    acc[key] = this.admin.controllers[key];

    return acc;
  }, {})
this.admin.models = Object.keys(this.admin.models || []).reduce((acc, key) => {
    if (!this.admin.models[key].identity) {
      this.admin.models[key].identity = upperFirst(key);
    }

    if (!this.admin.models[key].globalId) {
      this.admin.models[key].globalId = upperFirst(camelCase(`admin-${key}`));
    }

    if (!this.admin.models[key].connection) {
      this.admin.models[key].connection = this.config.currentEnvironment.database.defaultConnection;
    }

    acc[key] = this.admin.models[key];

    return acc;
  }, {})
this.plugins = Object.keys(this.plugins).reduce((acc, key) => {
    this.plugins[key].controllers = Object.keys(this.plugins[key].controllers || []).reduce((sum, index) => {
      if (!this.plugins[key].controllers[index].identity) {
        this.plugins[key].controllers[index].identity = index;
      }

      sum[index] = this.plugins[key].controllers[index];

      return sum;
    }, {});

    this.plugins[key].models = Object.keys(this.plugins[key].models || []).reduce((sum, index) => {
      if (!this.plugins[key].models[index].connection) {
        this.plugins[key].models[index].connection = this.config.currentEnvironment.database.defaultConnection;
      }

      if (!this.plugins[key].models[index].globalId) {
        this.plugins[key].models[index].globalId = upperFirst(camelCase(`${key}-${index}`));
      }

      if (!this.plugins[key].models[index].collectionName) {
        this.plugins[key].models[index].collectionName = `${key}_${index}`.toLowerCase();
      }

      s...
const middlewareCategories = ['request', 'response', 'security', 'server']
const flattenMiddlewaresConfig = middlewareCategories.reduce((acc, index) => {
    const current = merge(this.config.currentEnvironment[index], {
      public: defaults(this.config.public, {
        enabled: true
      }),
      favicon: defaults(this.config.favicon, {
        enabled: true
      })
    });

    if (isObject(current)) {
      acc = merge(acc, current);
    } else {
      acc[index] = current;
    }

    return acc;
  }, {})
merge(flattenMiddlewaresConfig, {
    // Necessary middlewares for the core.
    responses: {
      enabled: true
    },
    router: {
      enabled: true
    },
    logger: {
      enabled: true
    },
    boom: {
      enabled: true
    },
    mask: {
      enabled: true
    },
    // Necessary middlewares for the administration panel.
    cors: {
      enabled: true
    },
    xframe: {
      enabled: true
    },
    xss: {
      enabled: true
    }
  })
_tmp_56.responses = {
      enabled: true
    }
_tmp_57.enabled = true
_tmp_56.router = {
      enabled: true
    }
_tmp_58.enabled = true
_tmp_56.logger = {
      enabled: true
    }
_tmp_59.enabled = true
_tmp_56.boom = {
      enabled: true
    }
_tmp_60.enabled = true
_tmp_56.mask = {
      enabled: true
    }
_tmp_61.enabled = true
_tmp_56.cors = {
      enabled: true
    }
_tmp_62.enabled = true
_tmp_56.xframe = {
      enabled: true
    }
_tmp_63.enabled = true
_tmp_56.xss = {
      enabled: true
    }
_tmp_64.enabled = true
middlewareCategories.push('database')
const flattenHooksConfig = pullAll(Object.keys(this.config.currentEnvironment), middlewareCategories).reduce((acc, index) => {
    const current = this.config.currentEnvironment[index];

    if (isObject(current)) {
      acc = merge(acc, {
        [index]: current
      });
    } else {
      acc[index] = current;
    }

    return acc;
  }, {})
_iterator_3 = <operator>.iterator(this.config.connections)
const connection = this.config.connections[name]
const connector = connection.connector.replace('tysapi-hook-', '')
enableHookNestedDependencies.call(this, connector, flattenHooksConfig)
this.config.middleware.settings = Object.keys(this.middleware).reduce((acc, current) => {
    // Try to find the settings in the current environment, then in the main configurations.
    const currentSettings = merge(get(cloneDeep(this.middleware[current]), ['defaults', current], {}), flattenMiddlewaresConfig[current] || this.config.currentEnvironment[current] || this.config[current]);
    acc[current] = !isObject(currentSettings) ? {} : currentSettings;

    if (!acc[current].hasOwnProperty('enabled')) {
      this.log.warn(`(middleware:${current}) wasn't loaded due to missing key \`enabled\` in the configuration`);
    }

    // Ensure that enabled key exist by forcing to false.
    defaults(acc[current], { enabled : false });

    return acc;
  }, {})
this.config.hook.settings = Object.keys(this.hook).reduce((acc, current) => {
    // Try to find the settings in the current environment, then in the main configurations.
    const currentSettings = merge(get(cloneDeep(this.hook[current]), ['defaults', current], {}), flattenHooksConfig[current] || get(this.config.currentEnvironment, ['hook', current]) || get(this.config, ['hook', current]));
    acc[current] = !isObject(currentSettings) ? {} : currentSettings;

    if (!acc[current].hasOwnProperty('enabled')) {
      this.log.warn(`(hook:${current}) wasn't loaded due to missing key \`enabled\` in the configuration`);
    }

    // Ensure that enabled key exist by forcing to false.
    defaults(acc[current], { enabled : false });

    return acc;
  }, {})
this.config.port = get(this.config.currentEnvironment, 'server.port') || this.config.port
this.config.host = get(this.config.currentEnvironment, 'server.host') || this.config.host
const url = getURLFromSegments({ hostname: this.config.host, port: this.config.port })
const adminPath = get(this.config.currentEnvironment.server, 'admin.path', 'admin')
