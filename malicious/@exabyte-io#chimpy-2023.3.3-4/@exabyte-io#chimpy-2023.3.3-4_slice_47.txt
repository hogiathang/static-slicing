process.on('unhandledRejection', (reason, promise) => {
    log.error('[chimp] Detected an unhandledRejection:'.red);

    try {
      if (reason.type === 'CommandError' && reason.message === 'Promise never resolved with an truthy value') {
        reason.type += 'WebdriverIO CommandError (Promise never resolved with an truthy value)';
        reason.message = 'This usually happens when WebdriverIO assertions fail or timeout.';
        let hint = 'HINT: Check the step AFTER [' + lastStep.getKeyword() + lastStep.getName() + ']';
        let uri = lastStep.getUri();
        uri = uri.substring(process.cwd().length, uri.length);
        hint += ' (' + uri + ': >' + lastStep.getLine() + ')';
        log.error('[chimp][hooks] Reason:'.red);
        log.error('[chimp][hooks]'.red, reason.type.red);
        log.error('[chimp][hooks]'.red, reason.message.red);
        log.error(hint.yellow);
        reason.message += '\n' + hint;
      } else {
        log.error('[chimp][hooks]'.red, reason...
log.error('[chimp] Detected an unhandledRejection:'.red)
reason.type === 'CommandError' && reason.message === 'Promise never resolved with an truthy value'
reason.type += 'WebdriverIO CommandError (Promise never resolved with an truthy value)'
reason.message = 'This usually happens when WebdriverIO assertions fail or timeout.'
let hint = 'HINT: Check the step AFTER [' + lastStep.getKeyword() + lastStep.getName() + ']'
let uri = lastStep.getUri()
uri = uri.substring(process.cwd().length, uri.length)
hint += ' (' + uri + ': >' + lastStep.getLine() + ')'
log.error('[chimp][hooks] Reason:'.red)
log.error('[chimp][hooks]'.red, reason.type.red)
log.error('[chimp][hooks]'.red, reason.message.red)
log.error(hint.yellow)
reason.message += '\n' + hint
log.error('[chimp][hooks]'.red, reason.stack)
log.debug('[chimp][hooks] Could not provide error hint')
log.debug('[chimp][hooks] Promise:', JSON.parse(JSON.stringify(promise)))
log.debug('[chimp][hooks] Forcibly exiting Cucumber')
process.send(JSON.stringify(reason))
